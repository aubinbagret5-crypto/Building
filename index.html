<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Manager Invest - Plateforme semi-réelle</title>
<style>
body { font-family: Arial, sans-serif; margin:0; background:#f5f5f5; }
header { background:#4CAF50; color:white; padding:15px; text-align:center; }
nav { background:#333; overflow:hidden; }
nav a { float:left; display:block; color:white; text-align:center; padding:12px 16px; text-decoration:none; }
nav a:hover { background:#ddd; color:black; }
section { padding:20px; }
.plan-card, .investment-card { background:#fff; padding:15px; margin:10px 0; border-radius:10px; box-shadow:0 0 5px rgba(0,0,0,0.1); }
button { padding:8px 12px; border:none; border-radius:5px; background:#4CAF50; color:white; cursor:pointer; }
button:hover { background:#45a049; }
form { background:#fff; padding:20px; border-radius:10px; box-shadow:0 0 10px rgba(0,0,0,0.1); max-width:500px; margin:auto; }
input, select { width:100%; padding:8px; margin:5px 0 15px 0; border-radius:5px; border:1px solid #ccc; }
.result { background:#e9f7ef; padding:10px; border-radius:5px; margin-top:10px; }
table { width:100%; border-collapse: collapse; margin-top:15px; }
th, td { border:1px solid #ccc; padding:8px; text-align:center; }
th { background:#eee; }
</style>
</head>
<body>

<header>
  <h1>Manager Invest</h1>
  <p>Investissez et suivez vos gains facilement !</p>
</header>

<nav>
  <a href="#plans" onclick="showPage('plans')">Plans</a>
  <a href="#deposit" onclick="showPage('deposit')">Dépôt / Recharge</a>
  <a href="#withdraw" onclick="showPage('withdraw')">Retrait</a>
  <a href="#dashboard" onclick="showPage('dashboard')">Tableau de bord</a>
  <a href="#history" onclick="showPage('history')">Historique</a>
  <a href="#" id="logoutBtn" onclick="logout()">Se déconnecter</a>
</nav>

<!-- Page Inscription -->
<section id="signup">
  <h2>Créer un compte</h2>
  <p>Remplissez vos informations pour commencer. Vous recevrez un bonus de bienvenue de 1500 FCFA.</p>
  <form id="signupForm">
    <label>Prénom*</label><input type="text" id="firstName" required>
    <label>Nom*</label><input type="text" id="lastName" required>
    <label>Email*</label><input type="email" id="email" required>
    <label>Mot de passe*</label><input type="password" id="password" required>
    <button type="submit">S'inscrire</button>
  </form>
</section>

<!-- Page Plans -->
<section id="plans" style="display:none;">
  <h2>Nos Plans d’Investissement</h2>
  <p>Choisissez un plan et cliquez sur "Investir". Votre solde doit couvrir le montant du plan.</p>
  <div id="plansContainer"></div>
</section>

<!-- Page Dépôt -->
<section id="deposit" style="display:none;">
  <h2>Dépôt / Recharge</h2>
  <p>Pour recharger votre compte, utilisez votre Mobile Money :</p>
  <p><b>USSD :</b> *144*4*6*Montant# → Vous recevrez un code OTP</p>
  <form id="depositForm">
    <label>Montant à déposer</label>
    <input type="number" id="depositAmount" min="100" required>
    <label>Code OTP / Référence</label>
    <input type="text" id="depositCode" required>
    <button type="submit">Envoyer le code</button>
  </form>
  <p>Solde actuel : <span id="currentBalance">0</span> FCFA</p>
</section>

<!-- Page Retrait -->
<section id="withdraw" style="display:none;">
  <h2>Retrait</h2>
  <p>Retirez vos gains. Impôt de 5% appliqué.</p>
  <form id="withdrawForm">
    <label>Montant à retirer</label>
    <input type="number" id="withdrawAmount" min="1000" required>
    <button type="submit">Retirer</button>
  </form>
  <p>Solde actuel : <span id="withdrawBalance">0</span> FCFA</p>
</section>

<!-- Tableau de bord -->
<section id="dashboard" style="display:none;">
  <h2>Tableau de bord</h2>
  <p>Suivez vos investissements et gains.</p>
  <table>
    <thead>
      <tr>
        <th>Plan</th>
        <th>Montant investi</th>
        <th>Type / Durée</th>
        <th>Gain quotidien</th>
        <th>Gain total</th>
        <th>Retrait net</th>
      </tr>
    </thead>
    <tbody id="dashboardTable">
      <tr><td colspan="6">Aucun investissement pour l'instant.</td></tr>
    </tbody>
  </table>
</section>

<!-- Historique -->
<section id="history" style="display:none;">
  <h2>Historique des actions</h2>
  <table>
    <thead>
      <tr>
        <th>Date</th>
        <th>Action</th>
        <th>Montant</th>
        <th>Détails</th>
      </tr>
    </thead>
    <tbody id="historyTable">
      <tr><td colspan="4">Aucun historique pour l'instant.</td></tr>
    </tbody>
  </table>
</section>

<script>
// ======= Variables =======
let plansData = {
  2500: {term:'Long', days:60, daily:699},
  5000: {term:'Long', days:60, daily:1398},
  10000: {term:'Long', days:60, daily:2796},
  20000: {term:'Moyen', days:30, daily:5592},
  50000: {term:'Moyen', days:30, daily:13980},
  100000: {term:'Court', days:15, daily:27960},
  200000: {term:'Court', days:15, daily:55920},
  500000: {term:'Court', days:15, daily:139800},
  750000: {term:'Court', days:15, daily:209700},
  1000000: {term:'Court', days:15, daily:279600}
};
let users = JSON.parse(localStorage.getItem('users') || '[]');
let currentUser = JSON.parse(localStorage.getItem('currentUser') || 'null');
let sections = ['signup','plans','deposit','withdraw','dashboard','history'];

// ======= Navigation =======
function showPage(page){
  sections.forEach(s => document.getElementById(s).style.display='none');
  document.getElementById(page).style.display='block';
  updateMenu();
  if(page==='dashboard') renderDashboard();
  if(page==='history') renderHistory();
  if(page==='deposit') updateBalances();
  if(page==='withdraw') updateBalances();
}

// ======= Menu =======
function updateMenu(){
  document.getElementById('logoutBtn').style.display = currentUser ? 'inline-block' : 'none';
}

// ======= Inscription =======
document.getElementById('signupForm').addEventListener('submit', e=>{
  e.preventDefault();
  const firstName = document.getElementById('firstName').value;
  const lastName = document.getElementById('lastName').value;
  const email = document.getElementById('email').value;
  const password = document.getElementById('password').value;
  if(users.find(u=>u.email===email)) return alert('Cet email est déjà utilisé');
  currentUser = {
    firstName, lastName, email, password,
    balance: 1500,
    investments: [],
    history: [{date:new Date().toLocaleString(), action:'Inscription - Bonus 1500 FCFA', amount:1500, plan:'Bonus'}]
  };
  users.push(currentUser);
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  alert('Compte créé ! Bonus de 1500 FCFA ajouté. Faites un dépôt pour investir.');
  showPage('deposit');
});

// ======= Plans =======
const plansContainer = document.getElementById('plansContainer');
for(let key in plansData){
  const plan = plansData[key];
  plansContainer.innerHTML += `
    <div class="plan-card">
      <h3>${Number(key).toLocaleString()} FCFA – ${plan.term} terme (${plan.days}j)</h3>
      <p>Gain quotidien : ${plan.daily.toLocaleString()} FCFA</p>
      <p>Gain total : ${(plan.daily*plan.days).toLocaleString()} FCFA</p>
      <button onclick="invest(${key})">Investir</button>
    </div>`;
}

// ======= Investissement =======
function invest(planValue){
  if(!currentUser){ alert('Connectez-vous d’abord'); showPage('signup'); return;}
  if(currentUser.balance < planValue){ alert('Votre solde est insuffisant pour ce plan. Faites un dépôt.'); return;}
  const plan = plansData[planValue];
  currentUser.balance -= planValue;
  const totalGain = plan.daily * plan.days;
  const net = totalGain>1000 ? Math.round(totalGain*0.95) : 0;
  currentUser.investments.push({date:new Date().toLocaleString(), planValue, term:plan.term, days:plan.days, daily:plan.daily, total:totalGain, net});
  currentUser.history.push({date:new Date().toLocaleString(), action:'Investissement', amount:planValue, plan:plan.term});
  saveUser();
  alert(`Investissement réussi ! Solde restant : ${currentUser.balance.toLocaleString()} FCFA`);
  showPage('dashboard');
}

// ======= Dépôt semi-réel =======
document.getElementById('depositForm').addEventListener('submit', e=>{
  e.preventDefault();
  const amount = Number(document.getElementById('depositAmount').value);
  const code = document.getElementById('depositCode').value.trim();
  if(amount <= 0) return alert('Montant invalide');
  if(code === '') return alert('Veuillez saisir le code OTP');
  if(!currentUser.pendingDeposits) currentUser.pendingDeposits = [];
  currentUser.pendingDeposits.push({amount, code, date:new Date().toLocaleString()});
  currentUser.history.push({date:new Date().toLocaleString(), action:'Dépôt en attente', amount, plan:`Code OTP: ${code}`});
  saveUser();
  console.log(`Nouvelle recharge en attente ! Utilisateur : ${currentUser.email}, Montant : ${amount} FCFA, Code OTP : ${code}`);
  alert('Dépôt enregistré. Attendez la validation de l’administrateur.');
  updateBalances();
});

// ======= Validation admin =======
function validateDeposit(email, code){
  const user = users.find(u=>u.email===email);
  if(!user || !user.pendingDeposits) return alert('Aucun dépôt trouvé');
  const depositIndex = user.pendingDeposits.findIndex(d=>d.code===code);
  if(depositIndex===-1) return alert('Code OTP incorrect');
  const dep = user.pendingDeposits[depositIndex];
  user.balance += dep.amount;
  user.history.push({date:new Date().toLocaleString(), action:'Dépôt validé', amount:dep.amount, plan:`Code OTP: ${code}`});
  user.pendingDeposits.splice(depositIndex,1);
  saveUser();
  alert(`Dépôt de ${dep.amount.toLocaleString()} FCFA validé pour ${email}`);
}

// ======= Retrait =======
document.getElementById('withdrawForm').addEventListener('submit', e=>{
  e.preventDefault();
  const amount = Number(document.getElementById('withdrawAmount').value);
  if(amount<=0 || amount>currentUser.balance) return alert('Montant invalide ou solde insuffisant');
  const net = Math.round(amount*0.95);
  currentUser.balance -= amount;
  currentUser.history.push({date:new Date().toLocaleString(), action:'Retrait', amount, plan:`Net reçu ${net}`});
  saveUser();
  alert(`Retrait effectué ! Net reçu : ${net} FCFA`);
  updateBalances();
});

// ======= Dashboard =======
function renderDashboard(){
  const tbody = document.getElementById('dashboardTable');
  if(currentUser.investments.length===0){ tbody.innerHTML = '<tr><td colspan="6">Aucun investissement</td></tr>'; return; }
  tbody.innerHTML='';
  currentUser.investments.forEach(inv=>{
    tbody.innerHTML += `<tr>
      <td>${Number(inv.planValue).toLocaleString()}</td>
      <td>${Number(inv.planValue).toLocaleString()}</td>
      <td>${inv.term} / ${inv.days}j</td>
      <td>${Number(inv.daily).toLocaleString()}</td>
      <td>${Number(inv.total).toLocaleString()}</td>
      <td>${Number(inv.net).toLocaleString()}</td>
    </tr>`;
  });
}

// ======= Historique =======
function renderHistory(){
  const tbody = document.getElementById('historyTable');
  if(currentUser.history.length===0){ tbody.innerHTML='<tr><td colspan="4">Aucun historique</td></tr>'; return; }
  tbody.innerHTML='';
  currentUser.history.forEach(h=>{
    tbody.innerHTML += `<tr>
      <td>${h.date}</td>
      <td>${h.action}</td>
      <td>${Number(h.amount).toLocaleString()}</td>
      <td>${h.plan}</td>
    </tr>`;
  });
}

// ======= Balances =======
function updateBalances(){
  document.getElementById('currentBalance').innerText = currentUser.balance.toLocaleString();
  document.getElementById('withdrawBalance').innerText = currentUser.balance.toLocaleString();
}

// ======= Déconnexion =======
function logout(){
  currentUser=null;
  localStorage.setItem('currentUser',null);
  alert('Vous êtes déconnecté');
  showPage('signup');
}

// ======= Sauvegarde =======
function saveUser(){
  const index = users.findIndex(u=>u.email===currentUser.email);
  if(index>-1) users[index]=currentUser;
  localStorage.setItem('users', JSON.stringify(users));
  localStorage.setItem('currentUser', JSON.stringify(currentUser));
  updateBalances();
  renderDashboard();
  renderHistory();
}

// ======= Initialisation =======
showPage('signup');
</script>

</body>
</html>